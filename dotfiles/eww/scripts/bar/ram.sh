#!/bin/bash

ram_usage=$(free | awk '/Mem/ {printf "%.2f\n", ($3 / $2) * 33}')
ram_remaining=$(python3 -c "print(33 - $ram_usage)")

svg=$(cat << SVG
<svg xmlns="http://www.w3.org/2000/svg" width="33" height="33" fill="none" viewBox="0 0 33 33">
  <defs>
      <clipPath id="ramUsageClipPath">
          <rect x="0" y="$ram_remaining" width="33" height="$ram_usage" />
      </clipPath>
  </defs> 

  <g id="bg" style="opacity:0.25;">
    <path id="Subtract" fill="#fff" d="M29.099 16.78v-3.575c0-.906.872-1.648 1.938-1.648 1.066 0 1.938-.741 1.938-1.647V8.262c0-4.827-2.59-8.106-8.986-8.237H9.01C1.023.025.025 1.023.025 8.262v16.475c0 9.237-.999 8.238 9.691 8.238h13.568c10.69 0 9.691.999 9.691-8.238V22.81c0-.873-.407-1.714-1.143-2.34l-1.59-1.35c-.736-.627-1.143-1.467-1.143-2.34Z" opacity=".4"/>
    <path id="Vector" fill="#fff" d="m8.012 32.975-.096-6.39c-.02-.886-.657-1.598-1.45-1.598h-.019c-.811.022-1.449.756-1.43 1.663l.097 6.303c.154.022.328.022.502.022h2.396Z"/>
    <path id="Vector_2" fill="#fff" d="m13.005 32.975-.096-6.403c-.02-.869-.657-1.585-1.45-1.585h-.019c-.811.022-1.45.76-1.43 1.65l.097 6.338h2.898Z"/>
    <path id="Vector_3" fill="#fff" d="m17.997 32.953-.096-6.338c-.02-.902-.657-1.628-1.45-1.628h-.019c-.811.022-1.449.77-1.43 1.673l.097 6.315h2.435c.154 0 .309 0 .463-.022Z"/>
    <path id="Vector_4" fill="#fff" d="m27.983 32.953-.097-6.338c-.02-.902-.657-1.628-1.45-1.628h-.019c-.811.022-1.449.77-1.43 1.673l.097 6.315h2.435c.154 0 .309 0 .464-.022Z"/>
    <path id="Vector_5" fill="#fff" d="m22.99 32.953-.096-6.338c-.02-.902-.657-1.628-1.45-1.628h-.018c-.812.022-1.45.77-1.43 1.673l.096 6.315h2.435c.154 0 .309 0 .464-.022Z"/>
    <path id="Vector_6" fill="#fff" d="M22.99.037a37.643 37.643 0 0 0-.823-.012H10.865c-.29 0-.565 0-.823.012l-.032 1.785c0 .659 1.437 1.198 3.229 1.198h6.474c1.776 0 3.213-.533 3.229-1.192L22.99.037Z"/>
  </g>
  <g id="fg" clip-path="url(#ramUsageClipPath)">
    <path id="Subtract_2" fill="#fff" d="M29.099 16.78v-3.575c0-.906.872-1.648 1.938-1.648 1.066 0 1.938-.741 1.938-1.647V8.262c0-4.827-2.59-8.106-8.986-8.237H9.01C1.023.025.025 1.023.025 8.262v16.475c0 9.237-.999 8.238 9.691 8.238h13.568c10.69 0 9.691.999 9.691-8.238V22.81c0-.873-.407-1.714-1.143-2.34l-1.59-1.35c-.736-.627-1.143-1.467-1.143-2.34Z" opacity=".4"/>
    <path id="Vector_7" fill="#fff" d="m8.012 32.975-.096-6.39c-.02-.886-.657-1.598-1.45-1.598h-.019c-.811.022-1.449.756-1.43 1.663l.097 6.303c.154.022.328.022.502.022h2.396Z"/>
    <path id="Vector_8" fill="#fff" d="m13.005 32.975-.096-6.403c-.02-.869-.657-1.585-1.45-1.585h-.019c-.811.022-1.45.76-1.43 1.65l.097 6.338h2.898Z"/>
    <path id="Vector_9" fill="#fff" d="m17.997 32.953-.096-6.338c-.02-.902-.657-1.628-1.45-1.628h-.019c-.811.022-1.449.77-1.43 1.673l.097 6.315h2.435c.154 0 .309 0 .463-.022Z"/>
    <path id="Vector_10" fill="#fff" d="m27.983 32.953-.097-6.338c-.02-.902-.657-1.628-1.45-1.628h-.019c-.811.022-1.449.77-1.43 1.673l.097 6.315h2.435c.154 0 .309 0 .464-.022Z"/>
    <path id="Vector_11" fill="#fff" d="m22.99 32.953-.096-6.338c-.02-.902-.657-1.628-1.45-1.628h-.018c-.812.022-1.45.77-1.43 1.673l.096 6.315h2.435c.154 0 .309 0 .464-.022Z"/>
    <path id="Vector_12" fill="#fff" d="M22.99.037a37.643 37.643 0 0 0-.823-.012H10.865c-.29 0-.565 0-.823.012l-.032 1.785c0 .659 1.437 1.198 3.229 1.198h6.474c1.776 0 3.213-.533 3.229-1.192L22.99.037Z"/>
    </g>
</svg>
SVG
)

echo $svg > "/tmp/eww_bar_ram_current.svg"

echo "/tmp/eww_bar_ram_current.svg"
