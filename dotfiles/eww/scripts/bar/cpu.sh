#!/bin/bash

cpu_usage=$(mpstat 1 1 | awk '/all/ {print (100 - $NF) * 33 / 100}' | tail -n 1)
cpu_remaining=$(python3 -c "print(33 - $cpu_usage)")

svg=$(cat << SVG
<svg xmlns="http://www.w3.org/2000/svg" width="33" height="33" fill="none" viewBox="0 0 33 33" style="background: red;">>
    <defs>
        <clipPath id="cpuUsageClipPath">
            <rect x="0" y="$cpu_remaining" width="33" height="$cpu_usage" />
        </clipPath>
    </defs> 

    <g id="bg" style="opacity:0.25;">
      <path id="Vector" fill="#fff" d="M21.45 3.3h-9.9a8.253 8.253 0 0 0-8.25 8.25v9.9a8.253 8.253 0 0 0 8.25 8.25h9.9a8.253 8.253 0 0 0 8.25-8.25v-9.9a8.253 8.253 0 0 0-8.25-8.25Zm3.729 16.929a4.943 4.943 0 0 1-4.95 4.95H12.77a4.943 4.943 0 0 1-4.95-4.95v-7.458a4.943 4.943 0 0 1 4.95-4.95h7.441a4.943 4.943 0 0 1 4.95 4.95v7.458h.017Z" opacity=".4"/>
      <path id="Vector_2" fill="#fff" d="M11.649 1.238V3.3h-.1c-.824 0-1.616.116-2.375.347v-2.41C9.174.562 9.718 0 10.41 0c.677 0 1.238.561 1.238 1.238Z"/>
      <path id="Vector_3" fill="#fff" d="M17.738 1.238V3.3h-2.475V1.237C15.263.561 15.823 0 16.5 0s1.238.561 1.238 1.238Z"/>
      <path id="Vector_4" fill="#fff" d="M23.842 1.238v2.409A8.226 8.226 0 0 0 21.45 3.3h-.083V1.237c0-.676.561-1.237 1.238-1.237.676 0 1.237.561 1.237 1.238Z"/>
      <path id="Vector_5" fill="#fff" d="M33 10.395c0 .693-.545 1.238-1.238 1.238H29.7v-.083a8.23 8.23 0 0 0-.347-2.393h2.41c.692 0 1.237.562 1.237 1.238Z"/>
      <path id="Vector_6" fill="#fff" d="M33 16.5c0 .677-.544 1.238-1.237 1.238H29.7v-2.476h2.063c.693 0 1.237.545 1.237 1.238Z"/>
      <path id="Vector_7" fill="#fff" d="M33 22.605c0 .677-.545 1.238-1.238 1.238h-2.409a8.226 8.226 0 0 0 .347-2.393v-.082h2.062c.693 0 1.238.544 1.238 1.237Z"/>
      <path id="Vector_8" fill="#fff" d="M23.842 29.354v2.409c0 .676-.56 1.237-1.237 1.237a1.247 1.247 0 0 1-1.238-1.238V29.7h.083c.825 0 1.633-.116 2.392-.346Z"/>
      <path id="Vector_9" fill="#fff" d="M17.754 29.7v2.063c0 .676-.561 1.237-1.238 1.237a1.236 1.236 0 0 1-1.237-1.238V29.7h2.475Z"/>
      <path id="Vector_10" fill="#fff" d="M11.649 29.7v2.063c0 .676-.561 1.237-1.238 1.237a1.236 1.236 0 0 1-1.237-1.238v-2.409a8.115 8.115 0 0 0 2.376.347h.099Z"/>
      <path id="Vector_11" fill="#fff" d="M3.647 9.158A8.226 8.226 0 0 0 3.3 11.55v.082H1.237A1.236 1.236 0 0 1 0 10.396c0-.676.561-1.237 1.238-1.237h2.409Z"/>
      <path id="Vector_12" fill="#fff" d="M3.3 15.262v2.476H1.237A1.247 1.247 0 0 1 0 16.5c0-.693.561-1.238 1.238-1.238H3.3Z"/>
      <path id="Vector_13" fill="#fff" d="M3.647 23.843h-2.41A1.247 1.247 0 0 1 0 22.605c0-.693.561-1.238 1.238-1.238H3.3v.083c0 .825.116 1.634.347 2.393Z"/>
      <path id="Vector_14" fill="#fff" d="M25.18 12.771v7.441a4.943 4.943 0 0 1-4.95 4.95h-7.46a4.943 4.943 0 0 1-4.95-4.95v-7.441a4.943 4.943 0 0 1 4.95-4.95h7.442c2.739 0 4.966 2.228 4.966 4.95Z"/>
    </g>
    <g id="fg" clip-path="url(#cpuUsageClipPath)">
      <path id="Vector_15" fill="#fff" d="M21.45 3.3h-9.9a8.253 8.253 0 0 0-8.25 8.25v9.9a8.253 8.253 0 0 0 8.25 8.25h9.9a8.253 8.253 0 0 0 8.25-8.25v-9.9a8.253 8.253 0 0 0-8.25-8.25Zm3.729 16.929a4.943 4.943 0 0 1-4.95 4.95H12.77a4.943 4.943 0 0 1-4.95-4.95v-7.458a4.943 4.943 0 0 1 4.95-4.95h7.441a4.943 4.943 0 0 1 4.95 4.95v7.458h.017Z" opacity=".4"/>
      <path id="Vector_16" fill="#fff" d="M11.649 1.238V3.3h-.1c-.824 0-1.616.116-2.375.347v-2.41C9.174.562 9.718 0 10.41 0c.677 0 1.238.561 1.238 1.238Z"/>
      <path id="Vector_17" fill="#fff" d="M17.738 1.238V3.3h-2.475V1.237C15.263.561 15.823 0 16.5 0s1.238.561 1.238 1.238Z"/>
      <path id="Vector_18" fill="#fff" d="M23.842 1.238v2.409A8.226 8.226 0 0 0 21.45 3.3h-.083V1.237c0-.676.561-1.237 1.238-1.237.676 0 1.237.561 1.237 1.238Z"/>
      <path id="Vector_19" fill="#fff" d="M33 10.395c0 .693-.545 1.238-1.238 1.238H29.7v-.083a8.23 8.23 0 0 0-.347-2.393h2.41c.692 0 1.237.562 1.237 1.238Z"/>
      <path id="Vector_20" fill="#fff" d="M33 16.5c0 .677-.544 1.238-1.237 1.238H29.7v-2.476h2.063c.693 0 1.237.545 1.237 1.238Z"/>
      <path id="Vector_21" fill="#fff" d="M33 22.605c0 .677-.545 1.238-1.238 1.238h-2.409a8.226 8.226 0 0 0 .347-2.393v-.082h2.062c.693 0 1.238.544 1.238 1.237Z"/>
      <path id="Vector_22" fill="#fff" d="M23.842 29.354v2.409c0 .676-.56 1.237-1.237 1.237a1.247 1.247 0 0 1-1.238-1.238V29.7h.083c.825 0 1.633-.116 2.392-.346Z"/>
      <path id="Vector_23" fill="#fff" d="M17.754 29.7v2.063c0 .676-.561 1.237-1.238 1.237a1.236 1.236 0 0 1-1.237-1.238V29.7h2.475Z"/>
      <path id="Vector_24" fill="#fff" d="M11.649 29.7v2.063c0 .676-.561 1.237-1.238 1.237a1.236 1.236 0 0 1-1.237-1.238v-2.409a8.115 8.115 0 0 0 2.376.347h.099Z"/>
      <path id="Vector_25" fill="#fff" d="M3.647 9.158A8.226 8.226 0 0 0 3.3 11.55v.082H1.237A1.236 1.236 0 0 1 0 10.396c0-.676.561-1.237 1.238-1.237h2.409Z"/>
      <path id="Vector_26" fill="#fff" d="M3.3 15.262v2.476H1.237A1.247 1.247 0 0 1 0 16.5c0-.693.561-1.238 1.238-1.238H3.3Z"/>
      <path id="Vector_27" fill="#fff" d="M3.647 23.843h-2.41A1.247 1.247 0 0 1 0 22.605c0-.693.561-1.238 1.238-1.238H3.3v.083c0 .825.116 1.634.347 2.393Z"/>
      <path id="Vector_28" fill="#fff" d="M25.18 12.771v7.441a4.943 4.943 0 0 1-4.95 4.95h-7.46a4.943 4.943 0 0 1-4.95-4.95v-7.441a4.943 4.943 0 0 1 4.95-4.95h7.442c2.739 0 4.966 2.228 4.966 4.95Z"/>
    </g>
</svg>
SVG
)

echo $svg > "/tmp/eww_bar_cpu_current.svg"

echo "/tmp/eww_bar_cpu_current.svg"
