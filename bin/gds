#!/usr/bin/env bash
search_path="${1:-./}"

echo -e "Scanning for git repositories in \`$search_path\`"

repos=($(find "$search_path" -type d -name .git 2>/dev/null | xargs -n1 dirname))

YELLOW="\033[1;33m"
WHITE="\033[1;37m"
RESET="\033[0m"

for repo in "${repos[@]}"; do
	(
		repo_name=$(basename "$repo")
		status=$(cd "$repo" && git status -s 2>/dev/null)
		if [[ -n "$status" ]]; then
			echo -e "${YELLOW}DIRTY${RESET} ${YELLOW}${repo_name}${RESET}"
		else
			echo -e "${WHITE}CLEAN${RESET} ${WHITE}${repo_name}${RESET}"
		fi
	) &
done

wait
