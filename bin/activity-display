#!/usr/bin/env bash

if [ ! -f ~/.activity.tracker ]; then
	echo ""
	exit 0
fi

IFS=';' read -r start_time activity eta_seconds <~/.activity.tracker

activity=$(echo "$activity" | tr -d '"')
current_time=$(date +%s)
expected_end=$((start_time + eta_seconds))
diff=$((expected_end - current_time))

if [ "$diff" -gt 0 ]; then
	sign=""
	remaining=$diff
elif [ "$diff" -lt 0 ]; then
	sign="!"
	remaining=$((-diff))
else
	sign=""
	remaining=0
fi

hours=$((remaining / 3600))
minutes=$(((remaining % 3600) / 60))
seconds=$((remaining % 60))

printf "%s%02d:%02d:%02d %s\n" "$sign" "$hours" "$minutes" "$seconds" "$activity"
